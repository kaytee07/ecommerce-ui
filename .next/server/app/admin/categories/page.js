(()=>{var e={};e.id=4331,e.ids=[4331],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},20225:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>o}),a(46876),a(9457),a(64968),a(35866);var r=a(23191),s=a(88716),l=a(37922),i=a.n(l),n=a(95231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);a.d(t,d);let o=["",{children:["admin",{children:["categories",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,46876)),"/Users/kofitaylor/business/ecommerce-engine-frontend/src/app/admin/categories/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,9457)),"/Users/kofitaylor/business/ecommerce-engine-frontend/src/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,64968)),"/Users/kofitaylor/business/ecommerce-engine-frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/kofitaylor/business/ecommerce-engine-frontend/src/app/admin/categories/page.tsx"],u="/admin/categories/page",m={require:a,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/categories/page",pathname:"/admin/categories",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},77530:(e,t,a)=>{Promise.resolve().then(a.bind(a,27284))},39183:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});let r=(0,a(62881).Z)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},83855:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});let r=(0,a(62881).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},98091:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});let r=(0,a(62881).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},27284:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var r=a(10326),s=a(17577),l=a(35047),i=a(74723),n=a(68284),d=a(770),o=a(46226),c=a(55137),u=a(24660),m=a(83855),x=a(88307),p=a(94019),g=a(77506),y=a(71709),h=a(2114),f=a(941),b=a(39183),j=a(62881);let v=(0,j.Z)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),N=(0,j.Z)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var w=a(98091),k=a(63171),C=a(75248),P=a(68230);let Z=d.Ry({name:d.Z_().min(1,"Name is required").max(100),slug:d.Z_().regex(/^[a-z0-9-]*$/,"Only lowercase letters, numbers, and hyphens").optional(),description:d.Z_().max(500).optional(),parentId:d.Z_().nullable().optional(),displayOrder:d.Rx().int().min(0).default(0),active:d.O7().default(!0)});function S(){(0,l.useRouter)();let{user:e}=(0,C.t)(),t=(0,s.useMemo)(()=>e?(0,P.Zu)(e.roles):null,[e?.roles?.join("|")]);(0,s.useRef)(null);let[a,d]=(0,s.useState)([]),[f,b]=(0,s.useState)(!0),[j,v]=(0,s.useState)(!1),[N,w]=(0,s.useState)(null),[k,S]=(0,s.useState)(new Set),[M,_]=(0,s.useState)(""),[F,I]=(0,s.useState)(null),[A,U]=(0,s.useState)(null),[z,E]=(0,s.useState)(null),[O,D]=(0,s.useState)(!1),[R,$]=(0,s.useState)(null),[G,L]=(0,s.useState)(null),T=(0,s.useRef)(null),V=(0,s.useMemo)(()=>{let e=new Map,t=new Map;a.forEach(a=>{if(e.set(a.id,a),a.parentId){let e=t.get(a.parentId)||[];e.push(a),t.set(a.parentId,e)}});let r=new Map,s=a=>{if(r.has(a))return r.get(a);let l=e.get(a),i=l?.productCount||0;return(t.get(a)||[]).forEach(e=>{i+=s(e.id)}),r.set(a,i),i};return a.forEach(e=>s(e.id)),r},[a]),{register:B,handleSubmit:J,reset:W,setValue:H,formState:{errors:X,isSubmitting:K}}=(0,i.cI)({resolver:(0,n.F)(Z),defaultValues:{displayOrder:0,active:!0}});(0,s.useCallback)(async()=>{b(!0);try{let e=await c.x.get("/admin/categories");d(e.data.data||[])}catch(e){console.error("Failed to fetch categories",e),d([])}finally{b(!1)}},[]);let Q=async e=>{L(null);try{if(N){let t=await c.x.put(`/admin/categories/${N.id}`,e),a=t.data.data?.category,r=a?.imageUrl||N.imageUrl||null;if(z){D(!0);try{let e=new FormData;e.append("file",z);let t=await c.x.post(`/admin/categories/${N.id}/image`,e,{headers:{"Content-Type":"multipart/form-data"}});r=t.data.data?.imageUrl||r}catch(e){console.error("Failed to upload category image",e),L("Category updated, but image upload failed. Please try again.")}finally{D(!1)}}d(t=>t.map(t=>t.id===N.id?{...t,...a||e,imageUrl:r,slug:e.slug||Y(e.name)}:t))}else{let t=await c.x.post("/admin/categories",e),a=t.data.data?.category;if(a){let e=a.imageUrl||null;if(z){D(!0);try{let t=new FormData;t.append("file",z);let r=await c.x.post(`/admin/categories/${a.id}/image`,t,{headers:{"Content-Type":"multipart/form-data"}});e=r.data.data?.imageUrl||e}catch(e){console.error("Failed to upload category image",e),L("Category created, but image upload failed. Please try again.")}finally{D(!1)}}d(t=>[...t,{...a,imageUrl:e}])}}es()}catch(e){console.error("Failed to save category",e),L(e.response?.data?.message||"Failed to save category. Please try again.")}},Y=e=>e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),ee=async e=>{let t=e.target.files?.[0];if(!t)return;if(!["image/jpeg","image/png","image/webp"].includes(t.type)){$("Invalid file type. Please upload JPG, PNG, or WebP.");return}if(t.size>5242880){$("File too large. Maximum size is 5MB.");return}$(null),E(t);let a=new FileReader;a.onload=()=>{U(a.result)},a.readAsDataURL(t),T.current&&(T.current.value="")},et=e=>{w(e),H("name",e.name),H("slug",e.slug),H("description",e.description||""),H("parentId",e.parentId||null),H("displayOrder",e.displayOrder),H("active",e.active),U(e.imageUrl||null),E(null),$(null),v(!0)},ea=async e=>{if(confirm("Are you sure you want to delete this category?")){I(e),L(null);try{await c.x.delete(`/admin/categories/${e}`),d(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Failed to delete category",e),L(e.response?.data?.message||"Failed to delete category.")}finally{I(null)}}},er=async e=>{L(null);try{e.active?await c.x.delete(`/admin/categories/${e.id}`):await c.x.post(`/admin/categories/${e.id}/activate`),d(t=>t.map(t=>t.id===e.id?{...t,active:!t.active}:t))}catch(e){console.error("Failed to toggle category status",e),L(e.response?.data?.message||"Failed to update category status.")}},es=()=>{v(!1),w(null),U(null),E(null),$(null),W()},el=e=>{let t=new Set(k);t.has(e)?t.delete(e):t.add(e),S(t)},ei=a.filter(e=>e.name.toLowerCase().includes(M.toLowerCase())),en=ei.filter(e=>!e.parentId);return f?(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx(u.Od,{className:"h-10 w-64"}),(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[r.jsx(u.Od,{className:"h-8 w-full mb-4"}),[1,2,3,4,5].map(e=>r.jsx(u.Od,{className:"h-16 w-full mb-2"},e))]})]}):e&&!t?.canManageCategories?null:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Categories"}),(0,r.jsxs)(u.zx,{onClick:()=>v(!0),children:[r.jsx(m.Z,{className:"h-4 w-4 mr-2"}),"Add Category"]})]}),G&&r.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700",children:G}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx(x.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search categories...",value:M,onChange:e=>_(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),j&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[r.jsx("h2",{className:"text-lg font-semibold",children:N?"Edit Category":"Add Category"}),r.jsx("button",{onClick:es,className:"text-gray-400 hover:text-gray-600",children:r.jsx(p.Z,{className:"h-5 w-5"})})]}),(0,r.jsxs)("form",{onSubmit:J(Q),className:"flex-1 overflow-y-auto p-6 space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),r.jsx("input",{...B("name"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"}),X.name&&r.jsx("p",{className:"text-sm text-error mt-1",children:X.name.message})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Slug (auto-generated if empty)"}),r.jsx("input",{...B("slug"),placeholder:"e.g., electronics, clothing",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"}),X.slug&&r.jsx("p",{className:"text-sm text-error mt-1",children:X.slug.message})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),r.jsx("textarea",{...B("description"),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category Image (Optional)"}),r.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Used for storefront category display. JPG, PNG, or WebP up to 5MB."}),A?(0,r.jsxs)("div",{className:"relative w-32 h-32",children:[r.jsx(o.default,{src:A,alt:"Category image",fill:!0,className:"object-cover rounded-lg border border-gray-200"}),O&&r.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg",children:r.jsx(g.Z,{className:"h-6 w-6 text-white animate-spin"})}),!O&&r.jsx("button",{type:"button",onClick:()=>{U(null),E(null),$(null)},className:"absolute -top-2 -right-2 p-1 bg-white rounded-full shadow-md hover:bg-gray-100 transition-colors border border-gray-200",children:r.jsx(p.Z,{className:"h-4 w-4 text-gray-600"})})]}):r.jsx("button",{type:"button",onClick:()=>T.current?.click(),disabled:O,className:"w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary transition-colors flex flex-col items-center justify-center",children:O?r.jsx(g.Z,{className:"h-6 w-6 text-primary animate-spin"}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(y.Z,{className:"h-8 w-8 text-gray-400 mb-1"}),r.jsx("span",{className:"text-xs text-gray-500",children:"Add Image"})]})}),r.jsx("input",{ref:T,type:"file",accept:"image/jpeg,image/png,image/webp",onChange:ee,disabled:O,className:"hidden"}),R&&r.jsx("p",{className:"text-sm text-error mt-2",children:R})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parent Category"}),(0,r.jsxs)("select",{...B("parentId"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[r.jsx("option",{value:"",children:"None (Root Category)"}),a.filter(e=>e.id!==N?.id).map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Order"}),r.jsx("input",{type:"number",...B("displayOrder",{valueAsNumber:!0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",...B("active"),id:"active",className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),r.jsx("label",{htmlFor:"active",className:"text-sm text-gray-700",children:"Active"})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4 border-t border-gray-200 mt-4",children:[r.jsx(u.zx,{type:"button",variant:"outline",onClick:es,className:"flex-1",children:"Cancel"}),r.jsx(u.zx,{type:"submit",disabled:K,className:"flex-1",children:K?"Saving...":N?"Update":"Create"})]})]})]})}),r.jsx("div",{className:"bg-white rounded-lg border border-gray-200",children:r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),r.jsx("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Slug"}),r.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Products"}),r.jsx("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),r.jsx("th",{className:"text-right px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200",children:0===en.length?r.jsx("tr",{children:(0,r.jsxs)("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:[r.jsx(h.Z,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),r.jsx("p",{children:"No categories found"})]})}):en.map(e=>r.jsx(q,{category:e,allCategories:ei,level:0,expandedIds:k,toggleExpand:el,onEdit:et,onDelete:ea,onToggleActive:er,deletingId:F,productCountMap:V},e.id))})]})})})]})}function q({category:e,allCategories:t,level:a,expandedIds:l,toggleExpand:i,onEdit:n,onDelete:d,onToggleActive:c,deletingId:u,productCountMap:m}){let x=t.filter(t=>t.parentId===e.id),p=x.length>0,g=l.has(e.id),[y,j]=(0,s.useState)(!1),C=m.get(e.id)??e.productCount??0;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("tr",{className:(0,k.cn)(!e.active&&"bg-gray-50 text-gray-400"),children:[r.jsx("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center",style:{paddingLeft:`${24*a}px`},children:[p?r.jsx("button",{onClick:()=>i(e.id),className:"p-1 hover:bg-gray-100 rounded mr-2",children:g?r.jsx(f.Z,{className:"h-4 w-4"}):r.jsx(b.Z,{className:"h-4 w-4"})}):r.jsx("span",{className:"w-6 mr-2"}),e.imageUrl?r.jsx("div",{className:"relative w-8 h-8 mr-3 flex-shrink-0",children:r.jsx(o.default,{src:e.imageUrl,alt:e.name,fill:!0,className:"object-cover rounded"})}):r.jsx(h.Z,{className:"h-5 w-5 text-gray-400 mr-3 flex-shrink-0"}),r.jsx("span",{className:"font-medium",children:e.name})]})}),r.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 font-mono",children:e.slug}),r.jsx("td",{className:"px-6 py-4 text-center text-sm",children:C}),r.jsx("td",{className:"px-6 py-4 text-center",children:r.jsx("span",{className:(0,k.cn)("px-2 py-1 text-xs rounded-full",e.active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"),children:e.active?"Active":"Inactive"})}),r.jsx("td",{className:"px-6 py-4 text-right",children:(0,r.jsxs)("div",{className:"relative inline-block",children:[r.jsx("button",{onClick:()=>j(!y),className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(v,{className:"h-4 w-4"})}),y&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>j(!1)}),(0,r.jsxs)("div",{className:"absolute right-0 mt-1 w-40 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50",children:[(0,r.jsxs)("button",{onClick:()=>{n(e),j(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[r.jsx(N,{className:"h-4 w-4 mr-2"}),"Edit"]}),r.jsx("button",{onClick:()=>{c(e),j(!1)},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:e.active?"Deactivate":"Activate"}),(0,r.jsxs)("button",{onClick:()=>{d(e.id),j(!1)},disabled:u===e.id,className:"flex items-center w-full px-4 py-2 text-sm text-error hover:bg-gray-50 disabled:opacity-50",children:[r.jsx(w.Z,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})})]}),g&&x.map(e=>r.jsx(q,{category:e,allCategories:t,level:a+1,expandedIds:l,toggleExpand:i,onEdit:n,onDelete:d,onToggleActive:c,deletingId:u,productCountMap:m},e.id))]})}},46876:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(68570).createProxy)(String.raw`/Users/kofitaylor/business/ecommerce-engine-frontend/src/app/admin/categories/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[9977,2948,8454,7215,1984,4660,889],()=>a(20225));module.exports=r})();
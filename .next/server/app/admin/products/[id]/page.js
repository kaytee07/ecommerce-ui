(()=>{var e={};e.id=6857,e.ids=[6857],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},28094:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),r(50867),r(9457),r(64968),r(35866);var s=r(23191),a=r(88716),i=r(37922),l=r.n(i),o=r(95231),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);r.d(t,n);let d=["",{children:["admin",{children:["products",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,50867)),"/Users/kofitaylor/business/ecommerce-engine-frontend/src/app/admin/products/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,9457)),"/Users/kofitaylor/business/ecommerce-engine-frontend/src/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,64968)),"/Users/kofitaylor/business/ecommerce-engine-frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/kofitaylor/business/ecommerce-engine-frontend/src/app/admin/products/[id]/page.tsx"],u="/admin/products/[id]/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/products/[id]/page",pathname:"/admin/products/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},13020:(e,t,r)=>{Promise.resolve().then(r.bind(r,60604))},60604:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var s=r(10326),a=r(17577),i=r(35047),l=r(90434),o=r(74723),n=r(68284),d=r(770),c=r(55137),u=r(24660),m=r(30098),p=r(86333),x=r(75248),g=r(68230),h=r(63171);let y=d.Ry({name:d.Z_().min(1,"Name is required").max(255),description:d.Z_().optional(),price:d.oQ.number().positive("Price must be positive"),compareAtPrice:d.oQ.number().positive().optional().or(d.i0("")).or(d.i0(0)),sku:d.Z_().min(1,"SKU is required").max(100),categoryId:d.Z_().min(1,"Category is required"),active:d.O7().default(!0),featured:d.O7().default(!1)});function b(){let e=(0,i.useRouter)(),t=(0,i.useParams)();(0,i.useSearchParams)();let r=t.id,{user:d}=(0,x.t)(),b=(0,a.useMemo)(()=>d?(0,g.Zu)(d.roles):null,[d?.roles?.join("|")]);(0,a.useRef)(null);let[j,f]=(0,a.useState)(null),[v,N]=(0,a.useState)([]),[P,S]=(0,a.useState)([]),[k,w]=(0,a.useState)(null),[I,q]=(0,a.useState)(!0),[C,A]=(0,a.useState)(!1),[E,_]=(0,a.useState)(null),[R,F]=(0,a.useState)(null),[O,D]=(0,a.useState)(null),[U,T]=(0,a.useState)(null),[$,z]=(0,a.useState)(0),[G,L]=(0,a.useState)("RESTOCK"),[Z,Q]=(0,a.useState)(""),[M,K]=(0,a.useState)(!1),[H,B]=(0,a.useState)(!1),[J,V]=(0,a.useState)(""),[W,X]=(0,a.useState)(""),[Y,ee]=(0,a.useState)(""),[et,er]=(0,a.useState)(null),[es,ea]=(0,a.useState)(!1),[ei,el]=(0,a.useState)({}),{register:eo,handleSubmit:en,reset:ed,watch:ec,formState:{errors:eu}}=(0,o.cI)({resolver:(0,n.F)(y)}),em=ec("categoryId");(0,a.useCallback)(async()=>{q(!0);try{let[e,t]=await Promise.all([c.x.get(`/admin/products/${r}`),c.x.get("/admin/categories")]),s=e.data.data;f(s),N(t.data.data||[]);let a=(0,h.b6)(s);if(S(a?[a]:[]),ed({name:s.name,description:s.description||"",price:s.price,compareAtPrice:s.compareAtPrice||"",sku:s.sku,categoryId:s.categoryId,active:s.active??!0,featured:s.featured??!1}),s.attributes&&"object"==typeof s.attributes){let e={...s.attributes},t=e.images;if(t&&"object"==typeof t){let e={};for(let[r,s]of Object.entries(t))"string"==typeof s&&(e[r]=s);w(Object.keys(e).length?e:null)}else w(null);delete e.images,el(e)}let i=e=>e?e.length>=16?e.slice(0,16):e:"";V("number"==typeof s.discountPercentage?String(s.discountPercentage):""),X(i(s.discountStart||void 0)),ee(i(s.discountEnd||void 0));try{let e=await c.x.get(`/admin/inventory/${r}`);D(e.data.data)}catch(e){e.response?.status===404?(D(null),T("No inventory record found. Create one to track stock.")):T("Failed to load inventory.")}}catch(e){console.error("Failed to fetch product",e),_("Failed to load product. It may not exist.")}finally{q(!1)}},[r,ed]);let ep=async t=>{A(!0),_(null);try{let s={...ei,...k?{images:k}:{}},a={...t,compareAtPrice:t.compareAtPrice||void 0,attributes:s};await c.x.put(`/admin/products/${r}`,a),e.push("/admin/products")}catch(e){console.error("Failed to update product",e),_(e.response?.data?.message||"Failed to update product. Please try again.")}finally{A(!1)}},ex=async e=>{F(null);try{let t=new FormData;t.append("file",e);let s=(await c.x.post(`/admin/products/${r}/image`,t,{headers:{"Content-Type":"multipart/form-data"}})).data.data||{},a=s.images,i=a&&"object"==typeof a?a:s,l={};Object.entries(i).forEach(([e,t])=>{"string"==typeof t&&(l[e]=t)}),w(Object.keys(l).length?l:null);let o=i.thumbnail||i.medium||i.large||i.original;"string"==typeof o&&S([o])}catch(e){throw console.error("Failed to upload image",e),F(e.response?.data?.message||"Failed to upload image. Please try again."),e}},eg=async e=>{S(t=>t.filter((t,r)=>r!==e)),w(null)},eh=async()=>{T(null),K(!0);try{let e=await c.x.post(`/admin/inventory/${r}/adjust`,{quantity:$,adjustmentType:G,reason:Z||void 0});D(e.data.data),z(0),Q("")}catch(e){T(e.response?.data?.message||"Failed to adjust inventory.")}finally{K(!1)}},ey=async e=>{T(null),B(!0);try{let t=await c.x.post(`/admin/inventory/${r}?initialStock=${e}`);D(t.data.data),T(null)}catch(e){T(e.response?.data?.message||"Failed to create inventory.")}finally{B(!1)}},eb=e=>{if(e)return 16===e.length?`${e}:00`:e},ej=async()=>{er(null),ea(!0);try{let e=Number(J);if(Number.isNaN(e)){er("Discount percentage is required.");return}let t={discountPercentage:e},s=eb(W),a=eb(Y);s&&(t.startDate=s),a&&(t.endDate=a);let i=await c.x.post(`/admin/products/${r}/discount`,t);f(i.data.data)}catch(e){er(e.response?.data?.message||"Failed to apply discount.")}finally{ea(!1)}},ef=async()=>{er(null),ea(!0);try{let e=await c.x.delete(`/admin/products/${r}/discount`);f(e.data.data),V(""),X(""),ee("")}catch(e){er(e.response?.data?.message||"Failed to remove discount.")}finally{ea(!1)}};return I?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[s.jsx(u.Od,{className:"h-10 w-10 rounded-lg"}),s.jsx(u.Od,{className:"h-8 w-48"})]}),s.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Array.from({length:6}).map((e,t)=>s.jsx(u.Od,{className:"h-12 w-full"},t))})})]}):j||I?d&&!b?.canEditProducts?null:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[s.jsx(l.default,{href:"/admin/products",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(p.Z,{className:"h-5 w-5"})}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Product"})]}),E&&s.jsx("div",{className:"p-4 bg-error-bg text-error rounded-lg",children:E}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Images"}),s.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Upload images for your product. The first image will be the main product image."}),R&&s.jsx("div",{className:"mb-4 p-3 bg-error-bg text-error rounded-lg text-sm",children:R}),s.jsx(u.yR,{images:P,onUpload:ex,onRemove:eg,maxImages:5})]}),(0,s.jsxs)("form",{onSubmit:en(ep),className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx("div",{className:"md:col-span-2",children:s.jsx(u.II,{label:"Product Name",placeholder:"Enter product name",error:eu.name?.message,...eo("name")})}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("textarea",{placeholder:"Enter product description",rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-primary focus:ring-1 focus:ring-primary resize-none",...eo("description")}),eu.description&&s.jsx("p",{className:"mt-1 text-sm text-error",children:eu.description.message})]}),s.jsx(u.II,{label:"SKU",placeholder:"e.g., WG-PROD-001",error:eu.sku?.message,...eo("sku")}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,s.jsxs)("select",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-primary focus:ring-1 focus:ring-primary",...eo("categoryId"),children:[s.jsx("option",{value:"",children:"Select a category"}),v.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),eu.categoryId&&s.jsx("p",{className:"mt-1 text-sm text-error",children:eu.categoryId.message})]}),s.jsx(u.II,{label:"Price (GHS)",type:"number",step:"0.01",placeholder:"0.00",error:eu.price?.message,...eo("price")}),s.jsx(u.II,{label:"Compare at Price (GHS)",type:"number",step:"0.01",placeholder:"0.00 (optional)",error:eu.compareAtPrice?.message,...eo("compareAtPrice")}),(0,s.jsxs)("div",{className:"md:col-span-2 flex items-center gap-6",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary",...eo("active")}),s.jsx("span",{className:"text-sm text-gray-700",children:"Active"})]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary",...eo("featured")}),s.jsx("span",{className:"text-sm text-gray-700",children:"Featured"})]})]})]}),(0,s.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200 flex justify-end gap-4",children:[s.jsx(l.default,{href:"/admin/products",children:s.jsx(u.zx,{type:"button",variant:"outline",children:"Cancel"})}),s.jsx(u.zx,{type:"submit",isLoading:C,children:"Update Product"})]})]}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:s.jsx(m.x,{attributes:ei,onChange:el,categoryId:em})}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Discount"}),et&&s.jsx("div",{className:"mb-4 p-3 bg-error-bg text-error rounded-lg text-sm",children:et}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[s.jsx(u.II,{label:"Discount %",type:"number",step:"0.01",min:"0",max:"100",value:J,onChange:e=>V(e.target.value)}),s.jsx(u.II,{label:"Start Date (Optional)",type:"datetime-local",value:W,onChange:e=>X(e.target.value)}),s.jsx(u.II,{label:"End Date (Optional)",type:"datetime-local",value:Y,onChange:e=>ee(e.target.value)}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(u.zx,{onClick:ej,isLoading:es,disabled:""===J.trim(),children:"Apply"}),s.jsx(u.zx,{variant:"outline",onClick:ef,isLoading:es,disabled:!j?.discountPercentage,children:"Remove"})]})]}),j?.discountActive&&(0,s.jsxs)("p",{className:"mt-3 text-sm text-green-700",children:["Discount active: ",j.discountPercentage,"% off"]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Inventory"}),U&&s.jsx("div",{className:"mb-4 p-3 bg-error-bg text-error rounded-lg text-sm",children:U}),O?(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"rounded-lg border border-gray-200 p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Stock"}),s.jsx("p",{className:"text-xl font-semibold text-gray-900",children:O.stockQuantity})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-gray-200 p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Reserved"}),s.jsx("p",{className:"text-xl font-semibold text-gray-900",children:O.reservedQuantity})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-gray-200 p-4",children:[s.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Available"}),s.jsx("p",{className:"text-xl font-semibold text-gray-900",children:O.availableQuantity})]})]}):s.jsx("div",{className:"mb-6 text-sm text-gray-600",children:"Create an inventory record to track stock levels for this product."}),O?(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[s.jsx(u.II,{label:"Quantity",type:"number",value:$,onChange:e=>z(Number(e.target.value))}),s.jsx(u.Ph,{label:"Adjustment Type",options:[{value:"RESTOCK",label:"Restock"},{value:"ADJUSTMENT",label:"Adjustment"},{value:"SALE",label:"Sale"},{value:"RESERVE",label:"Reserve"},{value:"RELEASE",label:"Release"}],value:G,onChange:e=>L(e.target.value)}),s.jsx(u.II,{label:"Reason (optional)",value:Z,onChange:e=>Q(e.target.value)}),s.jsx(u.zx,{onClick:eh,isLoading:M,disabled:0===$,children:"Update Stock"})]}):(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 items-end",children:[s.jsx(u.II,{label:"Initial Stock",type:"number",value:$,onChange:e=>z(Number(e.target.value))}),s.jsx(u.zx,{onClick:()=>ey($),isLoading:H,disabled:$<0,children:"Create Inventory"})]})]})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[s.jsx(l.default,{href:"/admin/products",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(p.Z,{className:"h-5 w-5"})}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Product Not Found"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[s.jsx("p",{className:"text-gray-500 mb-4",children:"The product you're looking for doesn't exist."}),s.jsx(l.default,{href:"/admin/products",children:s.jsx(u.zx,{children:"Back to Products"})})]})]})}},50867:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`/Users/kofitaylor/business/ecommerce-engine-frontend/src/app/admin/products/[id]/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9977,2948,8454,7215,1984,4660,889,1211],()=>r(28094));module.exports=s})();
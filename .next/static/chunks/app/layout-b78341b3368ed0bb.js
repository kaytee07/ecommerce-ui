(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{4957:function(t,e,r){Promise.resolve().then(r.t.bind(r,2778,23)),Promise.resolve().then(r.bind(r,3097))},3097:function(t,e,r){"use strict";r.d(e,{Providers:function(){return h}});var n=r(7437),a=r(3427),i=r(9827),o=r(2265),s=r(1917),u=r(9376),c=r(5162);let l=["/login","/forgot-password","/reset-password","/verify-email","/account/profile"];function d(){let t=(0,u.useRouter)(),e=(0,u.usePathname)(),{user:r,isAuthenticated:n,isLoading:a}=(0,c.t)(),i=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{i.current||(i.current=!0,c.t.getState().checkAuth())},[]),(0,o.useEffect)(()=>{!a&&n&&(null==r?void 0:r.mustChangePassword)&&(l.some(t=>e.startsWith(t))||t.push("/account/profile"))},[a,n,null==r?void 0:r.mustChangePassword,e,t]),null}function h(t){let{children:e}=t,[r]=(0,o.useState)(()=>new a.S({defaultOptions:{queries:{staleTime:3e5,gcTime:18e5,refetchOnWindowFocus:!1,retry:1}}}));return(0,n.jsx)(i.aH,{client:r,children:(0,n.jsxs)(s.V,{children:[(0,n.jsx)(d,{}),e]})})}},1917:function(t,e,r){"use strict";r.d(e,{V:function(){return h},p:function(){return f}});var n=r(7437),a=r(2265),i=r(7279),o=r(1671),s=r(9322),u=r(6865),c=r(3245),l=r(2489);let d=(0,a.createContext)(void 0);function h(t){let{children:e}=t,[r,i]=(0,a.useState)([]);return(0,n.jsxs)(d.Provider,{value:{toasts:r,addToast:function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,n=Math.random().toString(36).substring(7);i(a=>[...a,{id:n,type:t,message:e,duration:r}])},removeToast:t=>{i(e=>e.filter(e=>e.id!==t))}},children:[e,(0,n.jsx)(g,{})]})}function f(){let t=(0,a.useContext)(d);if(!t)throw Error("useToast must be used within a ToastProvider");return{success:e=>t.addToast("success",e),error:e=>t.addToast("error",e),warning:e=>t.addToast("warning",e),info:e=>t.addToast("info",e)}}function g(){let t=(0,a.useContext)(d);return t?(0,n.jsx)("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2",children:t.toasts.map(e=>(0,n.jsx)(m,{toast:e,onClose:()=>t.removeToast(e.id)},e.id))}):null}function m(t){let{toast:e,onClose:r}=t;(0,a.useEffect)(()=>{if(e.duration){let t=setTimeout(r,e.duration);return()=>clearTimeout(t)}},[e.duration,r]);let d={success:(0,n.jsx)(o.Z,{className:"h-5 w-5"}),error:(0,n.jsx)(s.Z,{className:"h-5 w-5"}),warning:(0,n.jsx)(u.Z,{className:"h-5 w-5"}),info:(0,n.jsx)(c.Z,{className:"h-5 w-5"})};return(0,n.jsxs)("div",{className:(0,i.cn)("flex items-center gap-3 px-4 py-3 rounded-lg border shadow-lg animate-slide-up",{success:"bg-success-bg text-success border-success",error:"bg-error-bg text-error border-error",warning:"bg-warning-bg text-warning border-warning",info:"bg-info-bg text-info border-info"}[e.type]),role:"alert",children:[d[e.type],(0,n.jsx)("p",{className:"text-sm font-medium",children:e.message}),(0,n.jsx)("button",{onClick:r,className:"ml-2 opacity-70 hover:opacity-100",children:(0,n.jsx)(l.Z,{className:"h-4 w-4"})})]})}},6305:function(t,e,r){"use strict";r.d(e,{x:function(){return c}});var n=r(3464),a=r(8488);let i="http://localhost:8080/api/v1",o=!1,s=[],u=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;s.forEach(e=>{t?e.reject(t):e.resolve()}),s=[]},c=n.Z.create({baseURL:i,headers:{"Content-Type":"application/json"},withCredentials:!0});c.interceptors.response.use(t=>t,async t=>{var e;let r=t.config,l=(null==r?void 0:r.url)||"",d=l.includes("/auth/login")||l.includes("/auth/refresh")||l.includes("/auth/logout")||l.includes("/auth/me")||l.includes("/auth/verify-email")||l.includes("/auth/register")||l.includes("/auth/forgot-password")||l.includes("/auth/reset-password");if((null===(e=t.response)||void 0===e?void 0:e.status)===401&&!r._retry&&!d){if(o)return new Promise((t,e)=>{s.push({resolve:t,reject:e})}).then(()=>c(r)).catch(t=>Promise.reject(t));r._retry=!0,o=!0;try{return await n.Z.post("".concat(i,"/auth/refresh"),{},{withCredentials:!0}),u(null),c(r)}catch(e){u(e);let t=a.t.getState();return await t.logout(),window.location.pathname.startsWith("/login")||(window.location.href="/login"),Promise.reject(e)}finally{o=!1}}return Promise.reject(t)})},8488:function(t,e,r){"use strict";r.d(e,{t:function(){return u}});var n=r(3011),a=r(6885),i=r(6305);let o=!1,s=null,u=(0,n.U)()((0,a.tJ)((t,e)=>({user:null,isAuthenticated:!1,isLoading:!0,isRefreshing:!1,setUser:e=>t({user:e,isAuthenticated:!!e}),login:async e=>{let r=await i.x.post("/auth/login",e);try{let e=await i.x.get("/auth/me");t({user:e.data.data,isAuthenticated:!0,isLoading:!1})}catch(e){t({isAuthenticated:!0,isLoading:!1})}return r.data.data},register:async t=>(await i.x.post("/auth/register",t)).data.data,logout:async()=>{t({user:null,isAuthenticated:!1,isRefreshing:!1}),o=!1,s=null;try{await i.x.post("/auth/logout").catch(()=>{})}catch(t){}},refreshToken:async()=>o&&s?s:(o=!0,t({isRefreshing:!0}),s=(async()=>{try{await i.x.post("/auth/refresh");let e=await i.x.get("/auth/me");return t({user:e.data.data,isAuthenticated:!0,isRefreshing:!1}),!0}catch(e){return t({user:null,isAuthenticated:!1,isRefreshing:!1}),!1}finally{o=!1,s=null}})()),checkAuth:async()=>{if(!e().isLoading||!e().isRefreshing){t({isLoading:!0});try{let e=await i.x.get("/auth/me");t({user:e.data.data,isAuthenticated:!0,isLoading:!1})}catch(r){await e().refreshToken()?t({isLoading:!1}):t({user:null,isAuthenticated:!1,isLoading:!1})}}}}),{name:"auth-storage",storage:(0,a.FL)(()=>localStorage),partialize:t=>({user:t.user,isAuthenticated:t.isAuthenticated}),onRehydrateStorage:()=>t=>{t&&(t.isLoading=!1)}}))},5162:function(t,e,r){"use strict";r.d(e,{t:function(){return n.t},x:function(){return o}});var n=r(8488),a=r(3011),i=r(6305);let o=(0,a.U)((t,e)=>({cart:null,isLoading:!1,error:null,fetchCart:async()=>{t({isLoading:!0,error:null});try{let e=await i.x.get("/store/cart");t({cart:e.data.data})}catch(e){t({error:"Failed to load cart"})}finally{t({isLoading:!1})}},addItem:async(e,r,n)=>{t({isLoading:!0,error:null});try{let a=await i.x.post("/store/cart/items",{productId:e,quantity:r,selectedOptions:n});t({cart:a.data.data})}catch(e){var a,o,s;throw"INSUFFICIENT_STOCK"===(null===(s=e.response)||void 0===s?void 0:null===(o=s.data)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.errorCode)?t({error:"Not enough stock available"}):t({error:"Failed to add item"}),e}finally{t({isLoading:!1})}},updateQuantity:async(r,n,a,o)=>{let s=e().cart,u=t=>a?t.itemKey===a:t.productId===r;s&&t({cart:{...s,items:s.items.map(t=>u(t)?{...t,quantity:n,subtotal:t.priceAtAdd*n}:t),totalAmount:s.items.reduce((t,e)=>u(e)?t+e.priceAtAdd*n:t+e.subtotal,0)}});try{let e=await i.x.put("/store/cart/items/".concat(r),{quantity:n,itemKey:a,selectedOptions:o});t({cart:e.data.data})}catch(e){throw t({cart:s,error:"Failed to update quantity"}),e}},removeItem:async(r,n)=>{let a=e().cart,o=t=>n?t.itemKey===n:t.productId===r;if(a){let e=a.items.filter(t=>!o(t));t({cart:{...a,items:e,itemCount:e.length,totalAmount:e.reduce((t,e)=>t+e.subtotal,0)}})}try{let e=n?"?itemKey=".concat(encodeURIComponent(n)):"",a=await i.x.delete("/store/cart/items/".concat(r).concat(e));t({cart:a.data.data})}catch(e){throw t({cart:a,error:"Failed to remove item"}),e}},clearCart:async()=>{try{await i.x.post("/store/cart/clear"),t({cart:null})}catch(e){throw t({error:"Failed to clear cart"}),e}},clearError:()=>t({error:null})}))},7279:function(t,e,r){"use strict";r.d(e,{cn:function(){return i},dS:function(){return f},xG:function(){return o},p6:function(){return s},C7:function(){return u},KP:function(){return c},v2:function(){return d},b6:function(){return l}});var n=r(1994),a=r(3335);function i(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return(0,a.m6)((0,n.W)(e))}function o(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GHS",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"en-GH";return new Intl.NumberFormat(r,{style:"currency",currency:e}).format(t)}function s(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{year:"numeric",month:"long",day:"numeric"},r="string"==typeof t?new Date(t):t;return new Intl.DateTimeFormat("en-GH",e).format(r)}function u(t){let e=t.split("-");return e.length>=3?"#".concat(e[e.length-1]):t}function c(t){let e=t.attributes,r=null==e?void 0:e.images;if(!r)return null;if("string"==typeof r){try{let t=JSON.parse(r);if(t&&"object"==typeof t)return t}catch(t){}return null}return"object"!=typeof r?null:r}function l(t){var e,r;let n=c(t);return n?n.thumbnail||n.medium||n.large||n.original||null:t.imageUrl||(null===(r=t.images)||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.url)||null}function d(t){var e,r;let n=c(t);return n?n.original||n.large||n.medium||n.thumbnail||null:t.imageUrl||(null===(r=t.images)||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.url)||null}var h=r(6305);async function f(t){let e=new Map;if(!t||0===t.length)return e;try{((await h.x.post("/store/inventory/batch",t)).data.data||[]).forEach(t=>{t.productId&&e.set(t.productId,t)})}catch(t){console.error("Failed to fetch batch inventory",t)}return e}},2778:function(){}},function(t){t.O(0,[2461,6853,237,2971,2117,1744],function(){return t(t.s=4957)}),_N_E=t.O()}]);
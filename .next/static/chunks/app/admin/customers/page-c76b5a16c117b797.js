(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6781],{8213:function(e,s,a){Promise.resolve().then(a.bind(a,8004))},401:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});let l=(0,a(9205).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},2208:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});let l=(0,a(9205).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},9345:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});let l=(0,a(9205).Z)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},3041:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});let l=(0,a(9205).Z)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]])},8906:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});let l=(0,a(9205).Z)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},2449:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});let l=(0,a(9205).Z)("shopping-bag",[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]])},5805:function(e,s,a){"use strict";a.d(s,{Z:function(){return l}});let l=(0,a(9205).Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},8004:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return w}});var l=a(7437),t=a(2265),r=a(9376),n=a(6305),i=a(5162),c=a(9714),d=a(7279),o=a(3247),x=a(2489),m=a(9345),u=a(3041),h=a(8906),p=a(2449),g=a(1047);let y=(0,a(9205).Z)("user-cog",[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var j=a(401),f=a(5805),N=a(2208),v=a(8588);let b=[{value:"ROLE_USER",label:"Customer",description:"Regular customer account"},{value:"ROLE_ADMIN",label:"Admin",description:"Can manage users and admin operations"},{value:"ROLE_SUPPORT_AGENT",label:"Support Agent",description:"Can view and help with customer issues"},{value:"ROLE_WAREHOUSE",label:"Warehouse",description:"Can manage inventory and fulfill orders"},{value:"ROLE_CONTENT_MANAGER",label:"Content Manager",description:"Can manage products and categories"},{value:"ROLE_SUPER_ADMIN",label:"Super Admin",description:"Full access to all features"}];function w(){var e,s,a,w;let k=(0,r.useRouter)(),{user:C}=(0,i.t)(),E=(0,t.useMemo)(()=>C?(0,v.Zu)(C.roles):null,[null==C?void 0:null===(e=C.roles)||void 0===e?void 0:e.join("|")]),R=(0,t.useRef)(null),[S,O]=(0,t.useState)([]),[Z,A]=(0,t.useState)(!0),[_,L]=(0,t.useState)(null),[M,U]=(0,t.useState)(""),[z,V]=(0,t.useState)(null),[T,P]=(0,t.useState)([]),[q,D]=(0,t.useState)(!1),[G,H]=(0,t.useState)(null),F=null==C?void 0:null===(s=C.roles)||void 0===s?void 0:s.includes("ROLE_SUPER_ADMIN"),I=(0,t.useCallback)(async()=>{A(!0);try{var e;let s=await n.x.get("/admin/users");O((null===(e=s.data.data)||void 0===e?void 0:e.content)||s.data.data||[])}catch(e){console.error("Failed to fetch customers",e),O([])}finally{A(!1)}},[]);(0,t.useEffect)(()=>{if(!C)return;if(!(null==E?void 0:E.canViewUsers)){k.push("/admin");return}let e="".concat(C.id||C.username||"user");R.current!==e&&(R.current=e,I())},[C,null==E?void 0:E.canViewUsers,k,I]);let W=e=>{V(e),P(e.roles&&e.roles.length>0?e.roles:["ROLE_USER"]),H(null)},B=e=>{P(s=>{if(s.includes(e)){let a=s.filter(s=>s!==e);return 0===a.length?["ROLE_USER"]:a}return[...s,e]})},J=async()=>{if(z){D(!0),H(null);try{await n.x.post("/admin/users/".concat(z.id,"/roles"),{roles:T}),O(e=>e.map(e=>e.id===z.id?{...e,roles:T}:e)),(null==_?void 0:_.id)===z.id&&L({..._,roles:T}),V(null)}catch(a){var e,s;console.error("Failed to assign roles",a),H((null===(s=a.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"Failed to assign roles. Please try again.")}finally{D(!1)}}},K=S.filter(e=>(e.fullName||"").toLowerCase().includes(M.toLowerCase())||(e.email||"").toLowerCase().includes(M.toLowerCase())||(e.username||"").toLowerCase().includes(M.toLowerCase())),Q=e=>{if(!e)return"-";let s=new Date(e);return isNaN(s.getTime())?"-":s.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})},X=e=>e&&0!==e.length?e.includes("ROLE_SUPER_ADMIN")?{label:"Super Admin",color:"bg-purple-100 text-purple-800"}:e.includes("ROLE_CONTENT_MANAGER")?{label:"Content Manager",color:"bg-blue-100 text-blue-800"}:e.includes("ROLE_WAREHOUSE")?{label:"Warehouse",color:"bg-orange-100 text-orange-800"}:e.includes("ROLE_SUPPORT_AGENT")?{label:"Support",color:"bg-green-100 text-green-800"}:{label:"Customer",color:"bg-gray-100 text-gray-800"}:{label:"User",color:"bg-gray-100 text-gray-800"};return!C||(null==E?void 0:E.canViewUsers)?Z?(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)(c.Od,{className:"h-10 w-64"}),(0,l.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[1,2,3,4,5].map(e=>(0,l.jsx)(c.Od,{className:"h-16 w-full mb-2"},e))})]}):(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Customers"}),(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:[S.length," total customers"]})]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(o.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,l.jsx)("input",{type:"text",placeholder:"Search by name, email, or username...",value:M,onChange:e=>U(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),_&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg max-w-lg w-full p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold",children:"Customer Details"}),(0,l.jsx)("button",{onClick:()=>L(null),className:"text-gray-400 hover:text-gray-600",children:(0,l.jsx)(x.Z,{className:"h-5 w-5"})})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-semibold",children:(_.fullName||_.username||"U").charAt(0).toUpperCase()}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-semibold",children:_.fullName||_.username||"Unknown"}),(0,l.jsxs)("p",{className:"text-gray-500",children:["@",_.username]})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 py-2 border-b border-gray-100",children:[(0,l.jsx)(m.Z,{className:"h-5 w-5 text-gray-400"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("span",{children:_.email||"-"}),!0===_.emailVerified?(0,l.jsx)("span",{className:"ml-2 text-xs text-green-600",children:"(Verified)"}):!1===_.emailVerified?(0,l.jsx)("span",{className:"ml-2 text-xs text-yellow-600",children:"(Unverified)"}):null]})]}),_.phone&&(0,l.jsxs)("div",{className:"flex items-center gap-3 py-2 border-b border-gray-100",children:[(0,l.jsx)(u.Z,{className:"h-5 w-5 text-gray-400"}),(0,l.jsx)("span",{children:_.phone})]}),(0,l.jsxs)("div",{className:"flex items-center gap-3 py-2 border-b border-gray-100",children:[(0,l.jsx)(h.Z,{className:"h-5 w-5 text-gray-400"}),(0,l.jsx)("span",{className:(0,d.cn)("px-2 py-1 text-xs rounded-full",X(_.roles).color),children:X(_.roles).label})]}),(0,l.jsxs)("div",{className:"flex items-center gap-3 py-2 border-b border-gray-100",children:[(0,l.jsx)(p.Z,{className:"h-5 w-5 text-gray-400"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium",children:null!==(a=_.totalOrders)&&void 0!==a?a:0}),(0,l.jsx)("span",{className:"text-gray-500 ml-1",children:"orders"}),(0,l.jsx)("span",{className:"mx-2 text-gray-300",children:"|"}),(0,l.jsx)("span",{className:"font-medium",children:(0,d.xG)(null!==(w=_.totalSpent)&&void 0!==w?w:0)}),(0,l.jsx)("span",{className:"text-gray-500 ml-1",children:"total spent"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-3 py-2 border-b border-gray-100",children:[(0,l.jsx)(g.Z,{className:"h-5 w-5 text-gray-400"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500",children:"Joined "}),(0,l.jsx)("span",{children:Q(_.createdAt)})]})]}),_.lastOrderAt&&(0,l.jsxs)("div",{className:"flex items-center gap-3 py-2 border-b border-gray-100",children:[(0,l.jsx)(p.Z,{className:"h-5 w-5 text-gray-400"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500",children:"Last order "}),(0,l.jsx)("span",{children:Q(_.lastOrderAt)})]})]})]}),(0,l.jsxs)("div",{className:"flex gap-3 mt-6",children:[F&&(0,l.jsxs)(c.zx,{variant:"outline",onClick:()=>{L(null),W(_)},className:"flex-1",children:[(0,l.jsx)(y,{className:"h-4 w-4 mr-2"}),"Manage Roles"]}),(0,l.jsx)(c.zx,{variant:"outline",onClick:()=>L(null),className:"flex-1",children:"Close"})]})]})}),z&&F&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold",children:"Manage Roles"}),(0,l.jsx)("button",{onClick:()=>V(null),className:"text-gray-400 hover:text-gray-600",children:(0,l.jsx)(x.Z,{className:"h-5 w-5"})})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Assigning roles to:"}),(0,l.jsx)("p",{className:"font-medium",children:z.fullName||z.username||"Unknown"}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:z.email||"-"})]}),G&&(0,l.jsx)("div",{className:"mb-4 p-3 bg-error-bg text-error rounded-lg text-sm",children:G}),(0,l.jsx)("div",{className:"space-y-3 mb-6",children:b.map(e=>(0,l.jsxs)("label",{className:(0,d.cn)("flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors",T.includes(e.value)?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"),children:[(0,l.jsx)("div",{className:"pt-0.5",children:(0,l.jsx)("div",{className:(0,d.cn)("w-5 h-5 rounded border flex items-center justify-center",T.includes(e.value)?"bg-primary border-primary text-white":"border-gray-300"),children:T.includes(e.value)&&(0,l.jsx)(j.Z,{className:"h-3 w-3"})})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("input",{type:"checkbox",checked:T.includes(e.value),onChange:()=>B(e.value),className:"sr-only"}),(0,l.jsx)("p",{className:"font-medium text-sm",children:e.label}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:e.description})]})]},e.value))}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)(c.zx,{variant:"outline",onClick:()=>V(null),className:"flex-1",disabled:q,children:"Cancel"}),(0,l.jsx)(c.zx,{onClick:J,className:"flex-1",isLoading:q,children:"Save Roles"})]})]})}),(0,l.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full",children:[(0,l.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),(0,l.jsx)("th",{className:"text-left px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,l.jsx)("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Orders"}),(0,l.jsx)("th",{className:"text-right px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Spent"}),(0,l.jsx)("th",{className:"text-center px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,l.jsx)("th",{className:"text-right px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"}),(0,l.jsx)("th",{className:"text-right px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-gray-200",children:0===K.length?(0,l.jsx)("tr",{children:(0,l.jsxs)("td",{colSpan:7,className:"px-6 py-12 text-center text-gray-500",children:[(0,l.jsx)(f.Z,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,l.jsx)("p",{children:"No customers found"})]})}):K.map(e=>{var s,a;let t=X(e.roles);return(0,l.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-primary text-white rounded-full flex items-center justify-center font-medium",children:(e.fullName||e.username||"U").charAt(0).toUpperCase()}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium text-gray-900",children:e.fullName||"Unknown"}),(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:["@",e.username||"unknown"]})]})]})}),(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-sm",children:e.email||"-"}),e.emailVerified&&(0,l.jsx)("span",{className:"text-green-500",title:"Verified",children:(0,l.jsx)("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]})}),(0,l.jsx)("td",{className:"px-6 py-4 text-center",children:(0,l.jsx)("span",{className:"font-medium",children:null!==(s=e.totalOrders)&&void 0!==s?s:0})}),(0,l.jsx)("td",{className:"px-6 py-4 text-right font-medium",children:(0,d.xG)(null!==(a=e.totalSpent)&&void 0!==a?a:0)}),(0,l.jsx)("td",{className:"px-6 py-4 text-center",children:(0,l.jsx)("span",{className:(0,d.cn)("px-2 py-1 text-xs rounded-full",t.color),children:t.label})}),(0,l.jsx)("td",{className:"px-6 py-4 text-right text-sm text-gray-500",children:Q(e.createdAt)}),(0,l.jsx)("td",{className:"px-6 py-4 text-right",children:(0,l.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,l.jsx)("button",{onClick:()=>L(e),className:"p-2 text-gray-400 hover:text-primary rounded-lg hover:bg-gray-100",title:"View details",children:(0,l.jsx)(N.Z,{className:"h-4 w-4"})}),F&&(0,l.jsx)("button",{onClick:()=>W(e),className:"p-2 text-gray-400 hover:text-primary rounded-lg hover:bg-gray-100",title:"Manage roles",children:(0,l.jsx)(y,{className:"h-4 w-4"})})]})})]},e.id)})})]})})})]}):null}}},function(e){e.O(0,[2972,6853,5878,9714,9748,2971,2117,1744],function(){return e(e.s=8213)}),_N_E=e.O()}]);
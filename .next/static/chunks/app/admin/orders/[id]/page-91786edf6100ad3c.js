(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2643],{2662:function(e,s,r){Promise.resolve().then(r.bind(r,6106))},2660:function(e,s,r){"use strict";r.d(s,{Z:function(){return t}});let t=(0,r(9205).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},9388:function(e,s,r){"use strict";r.d(s,{Z:function(){return t}});let t=(0,r(9205).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},1723:function(e,s,r){"use strict";r.d(s,{Z:function(){return t}});let t=(0,r(9205).Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},3113:function(e,s,r){"use strict";r.d(s,{Z:function(){return t}});let t=(0,r(9205).Z)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},3774:function(e,s,r){"use strict";r.d(s,{Z:function(){return t}});let t=(0,r(9205).Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},2369:function(e,s,r){"use strict";r.d(s,{Z:function(){return t}});let t=(0,r(9205).Z)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},6106:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return k}});var t=r(7437),a=r(2265),l=r(9376),d=r(7648),i=r(3145),n=r(6305),c=r(9714),o=r(7279),u=r(1723),x=r(1671),m=r(4794);let h=(0,r(9205).Z)("truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);var p=r(9388),g=r(2660),y=r(3113),f=r(8736),N=r(3774),j=r(2369),v=r(1047),b=r(5162),E=r(8588);let w={PENDING:{label:"Pending",color:"bg-yellow-100 text-yellow-800",icon:u.Z},CONFIRMED:{label:"Confirmed",color:"bg-blue-100 text-blue-800",icon:x.Z},PROCESSING:{label:"Processing",color:"bg-purple-100 text-purple-800",icon:m.Z},SHIPPED:{label:"Shipped",color:"bg-green-100 text-green-800",icon:h},DELIVERED:{label:"Delivered",color:"bg-green-100 text-green-800",icon:x.Z},CANCELLED:{label:"Cancelled",color:"bg-gray-100 text-gray-800",icon:p.Z},REFUNDED:{label:"Refunded",color:"bg-red-100 text-red-800",icon:p.Z}},C={PENDING:["CONFIRMED","CANCELLED"],CONFIRMED:["PROCESSING","CANCELLED"],PROCESSING:["SHIPPED","CANCELLED"],SHIPPED:["DELIVERED"],DELIVERED:[],CANCELLED:["REFUNDED"],REFUNDED:[]};function k(){var e,s,r,m,p,k;let D=e=>"".concat(e.productId,"-").concat(JSON.stringify(e.selectedOptions||{})),O=(0,l.useParams)(),A=(0,l.useRouter)(),S=O.id,{user:I}=(0,b.t)(),P=(0,a.useMemo)(()=>I?(0,E.Zu)(I.roles):null,[null==I?void 0:null===(e=I.roles)||void 0===e?void 0:e.join("|")]),R=(0,a.useRef)(null),[Z,L]=(0,a.useState)(null),[F,M]=(0,a.useState)(!0),[G,U]=(0,a.useState)(!1),[H,V]=(0,a.useState)({open:!1,status:null}),[z,_]=(0,a.useState)(""),[q,T]=(0,a.useState)({}),[B,J]=(0,a.useState)({}),K=(0,a.useRef)(!1),Q=(0,a.useCallback)(async()=>{M(!0);try{let e=await n.x.get("/admin/orders/".concat(S));L(e.data.data)}catch(e){console.error("Failed to fetch order",e)}finally{M(!1)}},[S]),W=(0,a.useCallback)(async()=>{if(!K.current)try{var e;let s=new URLSearchParams;s.set("size","1000");let r=await n.x.get("/admin/users?".concat(s.toString())),t=(null===(e=r.data.data)||void 0===e?void 0:e.content)||r.data.data||[],a={};t.forEach(e=>{(null==e?void 0:e.id)&&(null==e?void 0:e.username)&&(a[e.id]=e.username)}),J(a),K.current=!0}catch(e){console.error("Failed to fetch users for order display",e)}},[]);(0,a.useEffect)(()=>{if(!I)return;if(!(null==P?void 0:P.canViewAllOrders)){A.push("/admin");return}let e="".concat(I.id||I.username||"user",":").concat(S);R.current!==e&&(R.current=e,Q())},[S,I,null==P?void 0:P.canViewAllOrders,A,Q]),(0,a.useEffect)(()=>{if(!(null==Z?void 0:Z.items)||0===Z.items.length)return;let e=Z.items.map(e=>e.productId).filter(e=>!q[e]);if(0===e.length)return;let s=!1;return(async()=>{try{let r=await Promise.all(e.map(async e=>{try{let s=await n.x.get("/store/products/".concat(e));return{id:e,product:s.data.data}}catch(e){return null}}));if(s)return;T(e=>{let s={...e};return r.forEach(e=>{if(null==e?void 0:e.product){let r=(0,o.b6)(e.product);r&&(s[e.id]=r)}}),s})}catch(e){}})(),()=>{s=!0}},[null==Z?void 0:Z.items,q]),(0,a.useEffect)(()=>{(null==Z?void 0:Z.userId)&&(B[Z.userId]||W())},[null==Z?void 0:Z.userId,B,W]);let X=async()=>{if(H.status&&Z){U(!0);try{let e=await n.x.put("/admin/orders/".concat(S,"/status"),{status:H.status,reason:z||void 0});L(e.data.data),V({open:!1,status:null}),_("")}catch(e){console.error("Failed to update status",e)}finally{U(!1)}}},Y=async()=>{if(Z){U(!0);try{let e=await n.x.put("/admin/orders/".concat(S,"/fulfill"));L(e.data.data)}catch(e){console.error("Failed to fulfill order",e)}finally{U(!1)}}},$=async()=>{if(Z){U(!0);try{let e=await n.x.put("/admin/orders/".concat(S,"/deliver"));L(e.data.data)}catch(e){console.error("Failed to mark as delivered",e)}finally{U(!1)}}},ee=e=>new Date(e).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});if(F)return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(c.Od,{className:"h-10 w-10 rounded-lg"}),(0,t.jsx)(c.Od,{className:"h-8 w-48"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,t.jsx)(c.Od,{className:"h-64 w-full"}),(0,t.jsx)(c.Od,{className:"h-48 w-full"})]}),(0,t.jsx)(c.Od,{className:"h-96 w-full"})]})]});if(I&&!(null==P?void 0:P.canViewAllOrders))return null;if(!Z)return(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Order Not Found"}),(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"The order you're looking for doesn't exist."}),(0,t.jsx)(d.default,{href:"/admin/orders",children:(0,t.jsx)(c.zx,{children:"Back to Orders"})})]});let es=(null===(s=w[Z.status])||void 0===s?void 0:s.icon)||u.Z,er=!!(null==P?void 0:P.canViewAllOrders),et=!!(null==P?void 0:P.canCancelOrders),ea=!!(null==P?void 0:P.canFulfillOrders),el=!!(null==P?void 0:P.canProcessRefunds),ed=(C[Z.status]||[]).filter(e=>!!er&&("CANCELLED"===e?et:"REFUNDED"===e?el:!["PROCESSING","SHIPPED","DELIVERED"].includes(e)||ea)),ei=Z.orderNumber||Z.orderCode?(0,o.C7)(Z.orderNumber||Z.orderCode||""):Z.id.slice(0,8).toUpperCase();return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(d.default,{href:"/admin/orders",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,t.jsx)(g.Z,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:["Order ",ei]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Placed on ",ee(Z.createdAt)]})]})]}),(0,t.jsxs)(c.Ct,{className:(0,o.cn)("text-sm px-3 py-1",null===(r=w[Z.status])||void 0===r?void 0:r.color),children:[(0,t.jsx)(es,{className:"h-4 w-4 mr-1"}),(null===(m=w[Z.status])||void 0===m?void 0:m.label)||Z.status]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,t.jsxs)("h2",{className:"font-semibold text-gray-900",children:["Order Items (",Z.itemCount,")"]})}),(0,t.jsx)("div",{className:"divide-y divide-gray-200",children:null===(p=Z.items)||void 0===p?void 0:p.map(e=>(0,t.jsxs)("div",{className:"p-6 flex items-center gap-4",children:[(0,t.jsx)("div",{className:"relative w-16 h-16 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0 flex items-center justify-center text-gray-400 text-xs",children:q[e.productId]?(0,t.jsx)(i.default,{src:q[e.productId],alt:e.productName,fill:!0,sizes:"64px",className:"object-cover"}):(0,t.jsx)(y.Z,{className:"h-6 w-6 text-gray-400"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:e.productName}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["SKU: ",e.sku]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Qty: ",e.quantity]}),e.selectedOptions&&Object.keys(e.selectedOptions).length>0&&(0,t.jsx)("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:Object.entries(e.selectedOptions).map(e=>{let[s,r]=e;return(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"uppercase tracking-wider text-gray-400",children:s}),(0,t.jsx)("span",{className:"font-medium text-gray-600",children:r})]},s)})})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:(0,o.xG)(e.subtotal)}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,o.xG)(e.priceAtOrder)," each"]})]})]},D(e)))}),(0,t.jsx)("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200",children:(0,t.jsxs)("div",{className:"flex justify-between font-semibold text-lg pt-2 border-t border-gray-200",children:[(0,t.jsx)("span",{children:"Total"}),(0,t.jsx)("span",{children:(0,o.xG)(Z.totalAmount)})]})})]}),Z.notes&&(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)(f.Z,{className:"h-5 w-5 text-gray-400"}),(0,t.jsx)("h2",{className:"font-semibold text-gray-900",children:"Order Notes"})]}),(0,t.jsx)("p",{className:"text-gray-600",children:Z.notes})]}),Z.shippingAddress&&(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)(N.Z,{className:"h-5 w-5 text-gray-400"}),(0,t.jsx)("h2",{className:"font-semibold text-gray-900",children:"Shipping Address"})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[Z.shippingAddress.street&&(0,t.jsx)("p",{children:Z.shippingAddress.street}),(Z.shippingAddress.city||Z.shippingAddress.region)&&(0,t.jsxs)("p",{children:[Z.shippingAddress.city,Z.shippingAddress.city&&Z.shippingAddress.region?", ":"",Z.shippingAddress.region]}),Z.shippingAddress.country&&(0,t.jsx)("p",{children:Z.shippingAddress.country}),Z.shippingAddress.postalCode&&(0,t.jsxs)("p",{children:["Postal Code: ",Z.shippingAddress.postalCode]}),Z.shippingAddress.phone&&(0,t.jsxs)("p",{children:["Phone: ",Z.shippingAddress.phone]}),Z.shippingAddress.gps&&(0,t.jsxs)("p",{children:["GPS: ",Z.shippingAddress.gps]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,t.jsx)("h2",{className:"font-semibold text-gray-900 mb-4",children:"Actions"}),(0,t.jsxs)("div",{className:"space-y-3",children:[ed.map(e=>(0,t.jsxs)(c.zx,{variant:"outline",className:"w-full justify-start",onClick:()=>V({open:!0,status:e}),disabled:G,children:["CONFIRMED"===e&&"Confirm Order","PROCESSING"===e&&"Start Processing","SHIPPED"===e&&"Mark as Shipped","DELIVERED"===e&&"Mark as Delivered","CANCELLED"===e&&"Cancel Order","REFUNDED"===e&&"Issue Refund"]},e)),"PROCESSING"===Z.status&&ea&&(0,t.jsxs)(c.zx,{className:"w-full",onClick:Y,isLoading:G,children:[(0,t.jsx)(h,{className:"h-4 w-4 mr-2"}),"Fulfill Order"]}),"SHIPPED"===Z.status&&ea&&(0,t.jsxs)(c.zx,{className:"w-full",onClick:$,isLoading:G,children:[(0,t.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Mark Delivered"]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)(j.Z,{className:"h-5 w-5 text-gray-400"}),(0,t.jsx)("h2",{className:"font-semibold text-gray-900",children:"Customer"})]}),(0,t.jsx)("p",{className:"text-gray-600 mb-1",children:Z.customerUsername||Z.userUsername||Z.customerName||Z.guestName||Z.guestEmail||B[Z.userId]||Z.userId}),Z.guestEmail?(0,t.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[Z.guestName&&(0,t.jsxs)("p",{children:["Name: ",Z.guestName]}),(0,t.jsxs)("p",{children:["Email: ",Z.guestEmail]}),(0,t.jsx)("p",{children:"Guest checkout"})]}):(0,t.jsx)(d.default,{href:"/admin/customers",className:"text-sm text-primary hover:underline",children:"View Customer"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)(v.Z,{className:"h-5 w-5 text-gray-400"}),(0,t.jsx)("h2",{className:"font-semibold text-gray-900",children:"Order Info"})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 space-y-2",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Created:"})," ",ee(Z.createdAt)]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Updated:"})," ",ee(Z.updatedAt)]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Order Code:"})," ",ei]})]})]})]})]}),(0,t.jsx)(c.sm,{isOpen:H.open,onClose:()=>{V({open:!1,status:null}),_("")},onConfirm:X,title:"Update Order Status",message:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("p",{children:["Are you sure you want to change the order status to"," ",(0,t.jsx)("strong",{children:H.status?null===(k=w[H.status])||void 0===k?void 0:k.label:""}),"?"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason (optional)"}),(0,t.jsx)("textarea",{value:z,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",rows:3,placeholder:"Enter a reason for this status change..."})]})]}),confirmText:"Update Status",isLoading:G})]})}}},function(e){e.O(0,[2972,6853,5878,9714,9748,2971,2117,1744],function(){return e(e.s=2662)}),_N_E=e.O()}]);
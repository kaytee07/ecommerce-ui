(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8668],{984:function(e,t,s){Promise.resolve().then(s.bind(s,1424))},6215:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"notFound")&&s.d(t,{notFound:function(){return a.notFound}}),s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},1424:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(7437),l=s(2265),r=s(9376),n=s(6305),c=s(9714),d=s(7279),i=s(5252),o=s(6275),x=s(4794),m=s(6215),u=s(9205);let h=(0,u.Z)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),g=(0,u.Z)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),y=(0,u.Z)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]);var p=s(5162),j=s(8588);function f(){var e,t;let s=(0,r.useRouter)(),{user:u}=(0,p.t)(),g=(0,l.useMemo)(()=>u?(0,j.Zu)(u.roles):null,[null==u?void 0:null===(e=u.roles)||void 0===e?void 0:e.join("|")]),y=(0,l.useRef)(null),[f,b]=(0,l.useState)(null),[w,k]=(0,l.useState)([]),[C,S]=(0,l.useState)([]),[P,R]=(0,l.useState)(null),[D,O]=(0,l.useState)([]),[Z,L]=(0,l.useState)(!0),[M,F]=(0,l.useState)(null),[V,E]=(0,l.useState)("7d"),A=(0,l.useCallback)(async()=>{L(!0),F(null);let{from:e,to:t}=T();try{let s=(await n.x.get("/admin/analytics/dashboard")).data.data;b(s),S((null==s?void 0:s.topProducts)||[]);let[a,l,r]=await Promise.all([n.x.get("/admin/analytics/funnel"),n.x.get("/admin/analytics/inventory/low-stock?threshold=5"),n.x.get("/admin/analytics/sales/daily?fromDate=".concat(e,"&toDate=").concat(t))]);R(a.data.data||null),O(l.data.data||[]),k(r.data.data||[])}catch(e){console.error("Failed to fetch analytics",e),F("Failed to load analytics data. Please ensure the backend is running."),b(null),k([]),S([]),R(null),O([])}finally{L(!1)}},[V]);(0,l.useEffect)(()=>{if(!u)return;if(!(null==g?void 0:g.canViewAnalytics)){s.push("/admin");return}let e="".concat(u.id||u.username||"user",":").concat(V);y.current!==e&&(y.current=e,A())},[V,u,null==g?void 0:g.canViewAnalytics,s,A]);let T=()=>{let e=new Date,t=new Date;return t.setDate(e.getDate()-("7d"===V?7:30)),{from:t.toISOString().split("T")[0],to:e.toISOString().split("T")[0]}};if(u&&!(null==g?void 0:g.canViewAnalytics))return null;let U=async e=>{let{from:t,to:s}=T();try{let a="/admin/analytics/export/".concat(e);("orders"===e||"payments"===e||"daily-sales"===e)&&(a+="?fromDate=".concat(t,"&toDate=").concat(s));let l=await n.x.get(a,{responseType:"blob"}),r=new Blob([l.data],{type:"text/csv"}),c=window.URL.createObjectURL(r),d=document.createElement("a");d.href=c,d.setAttribute("download","".concat(e,"-export-").concat(t,"-to-").concat(s,".csv")),document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(c)}catch(e){console.error("Failed to export",e),F("Failed to export data. Please try again.")}},_=e=>new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short"}),G=Math.max(...w.map(e=>e.totalRevenue),1),I=P&&P.cartCount>0?(P.successfulPayments/P.cartCount*100).toFixed(1):"0",Q="7d"===V?(null==f?void 0:f.weekOrderCount)||0:(null==f?void 0:f.monthOrderCount)||0,q="7d"===V?(null==f?void 0:f.weekRevenue)||0:(null==f?void 0:f.monthRevenue)||0;return Z?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(e=>(0,a.jsx)(c.Od,{className:"h-32 w-full"},e))}),(0,a.jsx)(c.Od,{className:"h-80 w-full"})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics"}),(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsxs)("select",{value:V,onChange:e=>E(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,a.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,a.jsx)("option",{value:"30d",children:"Last 30 days"})]})})]}),M&&(0,a.jsx)("div",{className:"p-4 bg-error-bg text-error rounded-lg",children:M}),f&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsx)(v,{title:"Total Revenue",value:(0,d.xG)(q),icon:i.Z}),(0,a.jsx)(v,{title:"Total Orders",value:Q.toString(),icon:o.Z}),(0,a.jsx)(v,{title:"Pending Orders",value:(null!==(t=null==P?void 0:P.pendingOrders)&&void 0!==t?t:0).toString(),icon:x.Z}),(0,a.jsx)(v,{title:"Avg Order Value",value:(0,d.xG)(Q>0?q/Q:0),icon:m.Z})]}),D.length>0&&(0,a.jsxs)("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg flex items-center gap-3",children:[(0,a.jsx)(x.Z,{className:"h-5 w-5 text-yellow-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-yellow-800",children:"Low Stock Alert"}),(0,a.jsxs)("p",{className:"text-sm text-yellow-700",children:[D.length," products are running low on stock"]})]})]}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Daily Sales"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"7d"===V?"Last 7 days":"Last 30 days"})]}),w&&0!==w.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-64 flex items-end gap-2",children:w.map((e,t)=>(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center gap-2",children:[(0,a.jsx)("div",{className:"w-full bg-gray-100 rounded-t relative",style:{height:"200px"},children:(0,a.jsx)("div",{className:"absolute bottom-0 w-full bg-primary rounded-t transition-all duration-300",style:{height:"".concat(e.totalRevenue/G*100,"%")}})}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:_(e.saleDate)})]},t))}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-6 mt-4 pt-4 border-t border-gray-100",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(0,d.xG)(w.reduce((e,t)=>e+t.totalRevenue,0))}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Total Revenue"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:w.reduce((e,t)=>e+t.orderCount,0)}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Total Orders"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:w.reduce((e,t)=>e+t.uniqueCustomers,0)}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Unique Customers"})]})]})]}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-gray-500",children:"No sales data available for this period"})]}),P&&(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Sales Funnel"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(N,{label:"Carts Created",value:P.cartCount,percentage:100}),(0,a.jsx)(N,{label:"Orders Placed",value:P.orderCount,percentage:P.cartCount>0?P.orderCount/P.cartCount*100:0}),(0,a.jsx)(N,{label:"Successful Payments",value:P.successfulPayments,percentage:P.cartCount>0?P.successfulPayments/P.cartCount*100:0}),P.failedPayments>0&&(0,a.jsx)(N,{label:"Failed Payments",value:P.failedPayments,percentage:P.orderCount>0?P.failedPayments/P.orderCount*100:0,isNegative:!0})]}),(0,a.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-100 text-center",children:[(0,a.jsxs)("p",{className:"text-3xl font-bold text-primary",children:[I,"%"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Conversion Rate"})]})]})]}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Top Products"}),C&&0!==C.length?(0,a.jsx)("div",{className:"space-y-4",children:C.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("span",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-medium",children:t+1}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 truncate",children:e.productName}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[e.totalSold," sold in ",e.orderCount," orders"]})]}),(0,a.jsx)("span",{className:"font-semibold",children:(0,d.xG)(e.totalRevenue)})]},e.productId))}):(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No sales data yet"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Export Data"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("button",{onClick:()=>U("orders"),className:"w-full flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5 text-gray-400"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"font-medium",children:"Orders Export"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Download all orders as CSV"})]})]}),(0,a.jsx)(h,{className:"h-5 w-5 text-gray-400"})]}),(0,a.jsxs)("button",{onClick:()=>U("payments"),className:"w-full flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(i.Z,{className:"h-5 w-5 text-gray-400"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"font-medium",children:"Payments Export"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Download payment history as CSV"})]})]}),(0,a.jsx)(h,{className:"h-5 w-5 text-gray-400"})]}),(0,a.jsxs)("button",{onClick:()=>U("inventory"),className:"w-full flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(x.Z,{className:"h-5 w-5 text-gray-400"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"font-medium",children:"Inventory Export"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Download inventory snapshot as CSV"})]})]}),(0,a.jsx)(h,{className:"h-5 w-5 text-gray-400"})]}),(0,a.jsxs)("button",{onClick:()=>U("daily-sales"),className:"w-full flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 text-gray-400"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"font-medium",children:"Daily Sales Export"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Download daily sales report as CSV"})]})]}),(0,a.jsx)(h,{className:"h-5 w-5 text-gray-400"})]})]})]})]}),D&&D.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Low Stock Products"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase",children:"Product"}),(0,a.jsx)("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 uppercase",children:"SKU"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500 uppercase",children:"Stock"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500 uppercase",children:"Reserved"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-xs font-medium text-gray-500 uppercase",children:"Available"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:D.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-3 font-medium",children:e.productName}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500 font-mono",children:e.sku}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:e.stockQuantity}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:e.reservedQuantity}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsx)("span",{className:0===e.availableQuantity?"text-error font-medium":"text-yellow-600",children:e.availableQuantity})})]},e.inventoryId))})]})})]})]})}function v(e){let{title:t,value:s,icon:l,trend:r}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:t}),(0,a.jsx)("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:(0,a.jsx)(l,{className:"h-5 w-5 text-primary"})})]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 mb-2",children:s}),r&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm ".concat(r.value>=0?"text-green-600":"text-red-600"),children:[r.value>=0?(0,a.jsx)(g,{className:"h-4 w-4"}):(0,a.jsx)(y,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:[Math.abs(r.value),"% ",r.label]})]})]})}function N(e){let{label:t,value:s,percentage:l,isNegative:r=!1}=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:t}),(0,a.jsx)("span",{className:"font-medium ".concat(r?"text-error":""),children:s.toLocaleString()})]}),(0,a.jsx)("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full transition-all duration-500 ".concat(r?"bg-error":"bg-primary"),style:{width:"".concat(Math.min(l,100),"%")}})})]})}}},function(e){e.O(0,[2972,6853,5878,9714,3550,2971,2117,1744],function(){return e(e.s=984)}),_N_E=e.O()}]);
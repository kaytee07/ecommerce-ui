(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8573],{8092:function(e,r,t){Promise.resolve().then(t.bind(t,9408))},9408:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return b}});var a=t(7437),s=t(2265),i=t(9376),o=t(7648),l=t(9501),c=t(5701),n=t(7119),d=t(6305),u=t(9714),m=t(2913),p=t(2660),x=t(5162),g=t(8588);let h=n.Ry({name:n.Z_().min(1,"Name is required").max(255),description:n.Z_().optional(),price:n.oQ.number().positive("Price must be positive"),compareAtPrice:n.oQ.number().positive().optional().or(n.i0("")),sku:n.Z_().min(1,"SKU is required").max(100),categoryId:n.Z_().min(1,"Category is required"),stockQuantity:n.oQ.number().int().min(0,"Stock cannot be negative"),active:n.O7().default(!0),featured:n.O7().default(!1)});function b(){var e,r,t,n,b,y;let f=(0,i.useRouter)(),{user:v}=(0,x.t)(),j=(0,s.useMemo)(()=>v?(0,g.Zu)(v.roles):null,[null==v?void 0:null===(e=v.roles)||void 0===e?void 0:e.join("|")]),N=(0,s.useRef)(null),[k,w]=(0,s.useState)([]),[I,P]=(0,s.useState)(!1),[S,C]=(0,s.useState)(null),[Q,_]=(0,s.useState)(null),[F,A]=(0,s.useState)({}),[E,O]=(0,s.useState)(null),{register:Z,handleSubmit:R,watch:U,formState:{errors:q}}=(0,l.cI)({resolver:(0,c.F)(h),defaultValues:{active:!0,featured:!1,stockQuantity:0}}),z=U("categoryId"),D=(0,s.useCallback)(async()=>{try{let e=await d.x.get("/admin/categories");w(e.data.data||[])}catch(e){console.error("Failed to fetch categories",e)}},[]);(0,s.useEffect)(()=>{if(!v)return;if(!(null==j?void 0:j.canCreateProducts)){f.push("/admin");return}let e="".concat(v.id||v.username||"user");N.current!==e&&(N.current=e,D())},[v,null==j?void 0:j.canCreateProducts,f,D]);let G=async e=>{var r,t,a,s;P(!0),C(null),_(null);try{let a={name:e.name,description:e.description,price:e.price,compareAtPrice:e.compareAtPrice||void 0,sku:e.sku,categoryId:e.categoryId,attributes:F,active:e.active,featured:e.featured},s=await d.x.post("/admin/products",a),i=null===(t=s.data.data)||void 0===t?void 0:null===(r=t.product)||void 0===r?void 0:r.id,o=!1;if(i&&E)try{let e=new FormData;e.append("file",E),await d.x.post("/admin/products/".concat(i,"/image"),e,{headers:{"Content-Type":"multipart/form-data"}})}catch(e){console.error("Failed to upload image during product creation",e),o=!0}if(i){let r="number"==typeof e.stockQuantity?e.stockQuantity:0;try{await d.x.post("/admin/inventory/".concat(i,"?initialStock=").concat(r))}catch(e){console.error("Failed to create initial inventory",e),_("Product created, but inventory setup failed. Please update stock from the edit page.")}}if(i){let e=o?"&image=failed":"";f.push("/admin/products/".concat(i,"?new=true").concat(e))}else f.push("/admin/products")}catch(e){console.error("Failed to create product",e),C((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.message)||"Failed to create product. Please try again.")}finally{P(!1)}};return!v||(null==j?void 0:j.canCreateProducts)?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(o.default,{href:"/admin/products",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,a.jsx)(p.Z,{className:"h-5 w-5"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Add New Product"})]}),S&&(0,a.jsx)("div",{className:"p-4 bg-error-bg text-error rounded-lg",children:S}),Q&&(0,a.jsx)("div",{className:"p-4 bg-yellow-50 text-yellow-800 rounded-lg",children:Q}),(0,a.jsx)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"Note:"})," You can optionally choose an image now. We'll upload it after the product is created and the backend will generate the thumbnail. You'll still be redirected to the edit page."]})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Product Image (Optional)"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Upload a main product image. The backend will create a thumbnail for small screens."}),(0,a.jsx)(u.Ur,{currentImage:null,onUpload:async e=>{O(e)},onRemove:()=>O(null),disabled:I})]}),(0,a.jsxs)("form",{onSubmit:R(G),className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)("div",{className:"md:col-span-2",children:(0,a.jsx)(u.II,{label:"Product Name",placeholder:"Enter product name",error:null===(r=q.name)||void 0===r?void 0:r.message,...Z("name")})}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,a.jsx)("textarea",{placeholder:"Enter product description",rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-primary focus:ring-1 focus:ring-primary resize-none",...Z("description")}),q.description&&(0,a.jsx)("p",{className:"mt-1 text-sm text-error",children:q.description.message})]}),(0,a.jsx)(u.II,{label:"SKU",placeholder:"e.g., WG-PROD-001",error:null===(t=q.sku)||void 0===t?void 0:t.message,...Z("sku")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,a.jsxs)("select",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-primary focus:ring-1 focus:ring-primary",...Z("categoryId"),children:[(0,a.jsx)("option",{value:"",children:"Select a category"}),k.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),q.categoryId&&(0,a.jsx)("p",{className:"mt-1 text-sm text-error",children:q.categoryId.message})]}),(0,a.jsx)(u.II,{label:"Price (GHS)",type:"number",step:"0.01",placeholder:"0.00",error:null===(n=q.price)||void 0===n?void 0:n.message,...Z("price")}),(0,a.jsx)(u.II,{label:"Compare at Price (GHS)",type:"number",step:"0.01",placeholder:"0.00 (optional)",error:null===(b=q.compareAtPrice)||void 0===b?void 0:b.message,...Z("compareAtPrice")}),(0,a.jsx)(u.II,{label:"Stock Quantity",type:"number",placeholder:"0",error:null===(y=q.stockQuantity)||void 0===y?void 0:y.message,...Z("stockQuantity")}),(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary",...Z("active")}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Active"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary",...Z("featured")}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Featured"})]})]})]}),(0,a.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200 flex justify-end gap-4",children:[(0,a.jsx)(o.default,{href:"/admin/products",children:(0,a.jsx)(u.zx,{type:"button",variant:"outline",children:"Cancel"})}),(0,a.jsx)(u.zx,{type:"submit",isLoading:I,children:"Create Product"})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm",children:(0,a.jsx)(m.x,{attributes:F,onChange:A,categoryId:z})})]}):null}}},function(e){e.O(0,[2972,6853,5878,2428,6572,9714,6279,2971,2117,1744],function(){return e(e.s=8092)}),_N_E=e.O()}]);
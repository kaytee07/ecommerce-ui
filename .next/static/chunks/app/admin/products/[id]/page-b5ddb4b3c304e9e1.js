(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6857],{9561:function(e,a,t){Promise.resolve().then(t.bind(t,4418))},4418:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return b}});var r=t(7437),s=t(2265),l=t(9376),i=t(7648),d=t(9501),o=t(5701),n=t(7119),c=t(6305),u=t(9714),m=t(2913),g=t(2660),p=t(5162),x=t(8588),v=t(7279);let h=n.Ry({name:n.Z_().min(1,"Name is required").max(255),description:n.Z_().optional(),price:n.oQ.number().positive("Price must be positive"),compareAtPrice:n.oQ.number().positive().optional().or(n.i0("")).or(n.i0(0)),sku:n.Z_().min(1,"SKU is required").max(100),categoryId:n.Z_().min(1,"Category is required"),active:n.O7().default(!0),featured:n.O7().default(!1)});function b(){var e,a,t,n,b;let y=(0,l.useRouter)(),j=(0,l.useParams)(),f=(0,l.useSearchParams)(),N=j.id,{user:S}=(0,p.t)(),I=(0,s.useMemo)(()=>S?(0,x.Zu)(S.roles):null,[null==S?void 0:null===(e=S.roles)||void 0===e?void 0:e.join("|")]),k=(0,s.useRef)(null),[w,P]=(0,s.useState)(null),[C,E]=(0,s.useState)([]),[A,R]=(0,s.useState)([]),[O,F]=(0,s.useState)(null),[D,_]=(0,s.useState)(!0),[T,z]=(0,s.useState)(!1),[L,U]=(0,s.useState)(null),[Z,Q]=(0,s.useState)(null),[q,K]=(0,s.useState)(null),[G,H]=(0,s.useState)(null),[M,B]=(0,s.useState)(0),[J,V]=(0,s.useState)("RESTOCK"),[W,X]=(0,s.useState)(""),[Y,$]=(0,s.useState)(!1),[ee,ea]=(0,s.useState)(!1),[et,er]=(0,s.useState)(""),[es,el]=(0,s.useState)(""),[ei,ed]=(0,s.useState)(""),[eo,en]=(0,s.useState)(null),[ec,eu]=(0,s.useState)(!1),[em,eg]=(0,s.useState)({}),{register:ep,handleSubmit:ex,reset:ev,watch:eh,formState:{errors:eb}}=(0,d.cI)({resolver:(0,o.F)(h)}),ey=eh("categoryId"),ej=(0,s.useCallback)(async()=>{_(!0);try{var e,a,t;let[r,s]=await Promise.all([c.x.get("/admin/products/".concat(N)),c.x.get("/admin/categories")]),l=r.data.data;P(l),E(s.data.data||[]);let i=(0,v.b6)(l);if(R(i?[i]:[]),ev({name:l.name,description:l.description||"",price:l.price,compareAtPrice:l.compareAtPrice||"",sku:l.sku,categoryId:l.categoryId,active:null===(e=l.active)||void 0===e||e,featured:null!==(a=l.featured)&&void 0!==a&&a}),l.attributes&&"object"==typeof l.attributes){let e={...l.attributes},a=e.images;if(a&&"object"==typeof a){let e={};for(let[t,r]of Object.entries(a))"string"==typeof r&&(e[t]=r);F(Object.keys(e).length?e:null)}else F(null);delete e.images,eg(e)}let d=e=>e?e.length>=16?e.slice(0,16):e:"";er("number"==typeof l.discountPercentage?String(l.discountPercentage):""),el(d(l.discountStart||void 0)),ed(d(l.discountEnd||void 0));try{let e=await c.x.get("/admin/inventory/".concat(N));K(e.data.data)}catch(e){(null===(t=e.response)||void 0===t?void 0:t.status)===404?(K(null),H("No inventory record found. Create one to track stock.")):H("Failed to load inventory.")}}catch(e){console.error("Failed to fetch product",e),U("Failed to load product. It may not exist.")}finally{_(!1)}},[N,ev]);(0,s.useEffect)(()=>{if(!S)return;if(!(null==I?void 0:I.canEditProducts)){y.push("/admin");return}let e="".concat(S.id||S.username||"user",":").concat(N);k.current!==e&&(k.current=e,ej())},[N,S,null==I?void 0:I.canEditProducts,y,ej]),(0,s.useEffect)(()=>{"failed"===f.get("image")&&Q("Image upload failed during product creation. Please upload again.")},[f]);let ef=async e=>{z(!0),U(null);try{let a={...em,...O?{images:O}:{}},t={...e,compareAtPrice:e.compareAtPrice||void 0,attributes:a};await c.x.put("/admin/products/".concat(N),t),y.push("/admin/products")}catch(e){var a,t;console.error("Failed to update product",e),U((null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.message)||"Failed to update product. Please try again.")}finally{z(!1)}},eN=async e=>{Q(null);try{let a=new FormData;a.append("file",e);let t=(await c.x.post("/admin/products/".concat(N,"/image"),a,{headers:{"Content-Type":"multipart/form-data"}})).data.data||{},r=t.images,s=r&&"object"==typeof r?r:t,l={};Object.entries(s).forEach(e=>{let[a,t]=e;"string"==typeof t&&(l[a]=t)}),F(Object.keys(l).length?l:null);let i=s.thumbnail||s.medium||s.large||s.original;"string"==typeof i&&R([i])}catch(e){var a,t;throw console.error("Failed to upload image",e),Q((null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.message)||"Failed to upload image. Please try again."),e}},eS=async e=>{R(a=>a.filter((a,t)=>t!==e)),F(null)},eI=async()=>{H(null),$(!0);try{let e=await c.x.post("/admin/inventory/".concat(N,"/adjust"),{quantity:M,adjustmentType:J,reason:W||void 0});K(e.data.data),B(0),X("")}catch(t){var e,a;H((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Failed to adjust inventory.")}finally{$(!1)}},ek=async e=>{H(null),ea(!0);try{let a=await c.x.post("/admin/inventory/".concat(N,"?initialStock=").concat(e));K(a.data.data),H(null)}catch(e){var a,t;H((null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.message)||"Failed to create inventory.")}finally{ea(!1)}},ew=e=>{if(e)return 16===e.length?"".concat(e,":00"):e},eP=async()=>{en(null),eu(!0);try{let e=Number(et);if(Number.isNaN(e)){en("Discount percentage is required.");return}let a={discountPercentage:e},t=ew(es),r=ew(ei);t&&(a.startDate=t),r&&(a.endDate=r);let s=await c.x.post("/admin/products/".concat(N,"/discount"),a);P(s.data.data)}catch(t){var e,a;en((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Failed to apply discount.")}finally{eu(!1)}},eC=async()=>{en(null),eu(!0);try{let e=await c.x.delete("/admin/products/".concat(N,"/discount"));P(e.data.data),er(""),el(""),ed("")}catch(t){var e,a;en((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Failed to remove discount.")}finally{eu(!1)}};return D?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(u.Od,{className:"h-10 w-10 rounded-lg"}),(0,r.jsx)(u.Od,{className:"h-8 w-48"})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Array.from({length:6}).map((e,a)=>(0,r.jsx)(u.Od,{className:"h-12 w-full"},a))})})]}):w||D?!S||(null==I?void 0:I.canEditProducts)?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(i.default,{href:"/admin/products",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(g.Z,{className:"h-5 w-5"})}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Product"})]}),L&&(0,r.jsx)("div",{className:"p-4 bg-error-bg text-error rounded-lg",children:L}),(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Product Images"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Upload images for your product. The first image will be the main product image."}),Z&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-error-bg text-error rounded-lg text-sm",children:Z}),(0,r.jsx)(u.yR,{images:A,onUpload:eN,onRemove:eS,maxImages:5})]}),(0,r.jsxs)("form",{onSubmit:ex(ef),className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsx)(u.II,{label:"Product Name",placeholder:"Enter product name",error:null===(a=eb.name)||void 0===a?void 0:a.message,...ep("name")})}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,r.jsx)("textarea",{placeholder:"Enter product description",rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-primary focus:ring-1 focus:ring-primary resize-none",...ep("description")}),eb.description&&(0,r.jsx)("p",{className:"mt-1 text-sm text-error",children:eb.description.message})]}),(0,r.jsx)(u.II,{label:"SKU",placeholder:"e.g., WG-PROD-001",error:null===(t=eb.sku)||void 0===t?void 0:t.message,...ep("sku")}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,r.jsxs)("select",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-primary focus:ring-1 focus:ring-primary",...ep("categoryId"),children:[(0,r.jsx)("option",{value:"",children:"Select a category"}),C.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]}),eb.categoryId&&(0,r.jsx)("p",{className:"mt-1 text-sm text-error",children:eb.categoryId.message})]}),(0,r.jsx)(u.II,{label:"Price (GHS)",type:"number",step:"0.01",placeholder:"0.00",error:null===(n=eb.price)||void 0===n?void 0:n.message,...ep("price")}),(0,r.jsx)(u.II,{label:"Compare at Price (GHS)",type:"number",step:"0.01",placeholder:"0.00 (optional)",error:null===(b=eb.compareAtPrice)||void 0===b?void 0:b.message,...ep("compareAtPrice")}),(0,r.jsxs)("div",{className:"md:col-span-2 flex items-center gap-6",children:[(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary",...ep("active")}),(0,r.jsx)("span",{className:"text-sm text-gray-700",children:"Active"})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary",...ep("featured")}),(0,r.jsx)("span",{className:"text-sm text-gray-700",children:"Featured"})]})]})]}),(0,r.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200 flex justify-end gap-4",children:[(0,r.jsx)(i.default,{href:"/admin/products",children:(0,r.jsx)(u.zx,{type:"button",variant:"outline",children:"Cancel"})}),(0,r.jsx)(u.zx,{type:"submit",isLoading:T,children:"Update Product"})]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm",children:(0,r.jsx)(m.x,{attributes:em,onChange:eg,categoryId:ey})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Discount"}),eo&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-error-bg text-error rounded-lg text-sm",children:eo}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[(0,r.jsx)(u.II,{label:"Discount %",type:"number",step:"0.01",min:"0",max:"100",value:et,onChange:e=>er(e.target.value)}),(0,r.jsx)(u.II,{label:"Start Date (Optional)",type:"datetime-local",value:es,onChange:e=>el(e.target.value)}),(0,r.jsx)(u.II,{label:"End Date (Optional)",type:"datetime-local",value:ei,onChange:e=>ed(e.target.value)}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(u.zx,{onClick:eP,isLoading:ec,disabled:""===et.trim(),children:"Apply"}),(0,r.jsx)(u.zx,{variant:"outline",onClick:eC,isLoading:ec,disabled:!(null==w?void 0:w.discountPercentage),children:"Remove"})]})]}),(null==w?void 0:w.discountActive)&&(0,r.jsxs)("p",{className:"mt-3 text-sm text-green-700",children:["Discount active: ",w.discountPercentage,"% off"]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Inventory"}),G&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-error-bg text-error rounded-lg text-sm",children:G}),q?(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"rounded-lg border border-gray-200 p-4",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Stock"}),(0,r.jsx)("p",{className:"text-xl font-semibold text-gray-900",children:q.stockQuantity})]}),(0,r.jsxs)("div",{className:"rounded-lg border border-gray-200 p-4",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Reserved"}),(0,r.jsx)("p",{className:"text-xl font-semibold text-gray-900",children:q.reservedQuantity})]}),(0,r.jsxs)("div",{className:"rounded-lg border border-gray-200 p-4",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Available"}),(0,r.jsx)("p",{className:"text-xl font-semibold text-gray-900",children:q.availableQuantity})]})]}):(0,r.jsx)("div",{className:"mb-6 text-sm text-gray-600",children:"Create an inventory record to track stock levels for this product."}),q?(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[(0,r.jsx)(u.II,{label:"Quantity",type:"number",value:M,onChange:e=>B(Number(e.target.value))}),(0,r.jsx)(u.Ph,{label:"Adjustment Type",options:[{value:"RESTOCK",label:"Restock"},{value:"ADJUSTMENT",label:"Adjustment"},{value:"SALE",label:"Sale"},{value:"RESERVE",label:"Reserve"},{value:"RELEASE",label:"Release"}],value:J,onChange:e=>V(e.target.value)}),(0,r.jsx)(u.II,{label:"Reason (optional)",value:W,onChange:e=>X(e.target.value)}),(0,r.jsx)(u.zx,{onClick:eI,isLoading:Y,disabled:0===M,children:"Update Stock"})]}):(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 items-end",children:[(0,r.jsx)(u.II,{label:"Initial Stock",type:"number",value:M,onChange:e=>B(Number(e.target.value))}),(0,r.jsx)(u.zx,{onClick:()=>ek(M),isLoading:ee,disabled:M<0,children:"Create Inventory"})]})]})]}):null:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(i.default,{href:"/admin/products",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(g.Z,{className:"h-5 w-5"})}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Product Not Found"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:"The product you're looking for doesn't exist."}),(0,r.jsx)(i.default,{href:"/admin/products",children:(0,r.jsx)(u.zx,{children:"Back to Products"})})]})]})}}},function(e){e.O(0,[2972,6853,5878,2428,6572,9714,6279,2971,2117,1744],function(){return e(e.s=9561)}),_N_E=e.O()}]);